-#   Copyright (c) 2010-2011, Diaspora Inc.  This file is
-#   licensed under the Affero General Public License version 3 or later.  See
-#   the COPYRIGHT file.
- content_for :page_title do
  = "New Quiz"

#left_pane
  #left_pane_header{:style => "height:100%;background-color:#999999"}
    %h3
      = "Quiz Details"    
    = form_for @quiz, html: {class: "new_conversation form_do_not_clear"}, remote: true do |quiz|
    
      %h5.fieldWithErrors Title
      = text_area_tag 'quiz[title]', nil, :rows => 10, :cols => 3, :placeholder => 'About the quiz..'
      %div{:style => 'padding-left:29px;padding-bottom:10px;'}      
        = check_box_tag 'quiz[randomize_questions]', 'true' , true, :style => 'float:left;'
        %span{:style => 'margin-left:4px;vertical-align:middle;'} Randomize questions
      

      %h5.fieldWithErrors Time Limit
      = text_field_tag 'quiz[time]', '15', :style => 'width:10%;display:inline-block;'
      %span Minutes   
            
      %h5{:style => 'display:inline-block;'} Total Marks:
      = text_field_tag 'quiz[total_marks]', '0', :disabled => true, :style => 'width:15%;display:inline-block;'
      %span Points
        
      .rightBar
        .title      
          %h5{:style => 'margin:5px;'}
            = "Questions"


        #qlist
          = "Empty questions set."

      %div{:style => 'margin-top:10px;text-align:center;'}
        = quiz.submit "  Create Quiz  ", 'data-disable-with' => "In Progress..", :class => 'button creation'

.span-15.prepend-9.last
  
  #people_stream.stream.contacts
    = link_to "Add question", "#", :id=>"question_add", :class => 'button creation', :style =>'float:right;margin:10px;'    
  %h4
    = "Create a question"
  #quiz_accordion

  #form_space    
  

  #hidden_form.hidden
    = render 'questions/new'


    

:javascript
  $('#question_form_cancel').live('click', function(){
    hidden_form_active = false;
    $('#form_space').empty();
    $("#question_add").addClass('creation');
  //  $.facebox.close();
  });
  
  hidden_form_active = false;
  //$('#quiz_accordion').accordion();  

  $('#question_add').live('click', function(){
      
    if(hidden_form_active){
      Diaspora.page.flashMessages.render({ 'success':true, 'notice':'A question is already in process..' });
    }
    else {
      $('#form_space').append($('#hidden_form').html());
      $("#question_add").removeClass('creation');
      hidden_form_active = true;
    }
    
  //  return false;
  });

  function addToQuiz(id, description,mark)
  {
    var count = $("#qlist").children("div").length
    if (count == 0){
      $('#qlist').empty();  
    }

    count = count + 1;

    var temp_str = '<div class="truncate">' + count + '. ' + description + '</div><input name="quiz[quiz_questions_attributes][][question_id]" type="hidden" value="' + id + '"/><input name="quiz[quiz_questions_attributes][][mark]" type="hidden" value="' + mark + '"/>';
    
    $('#qlist').append(temp_str);
    $('#quiz_total_marks').val(parseInt($('#quiz_total_marks').val()) + parseInt(mark));
    Diaspora.page.flashMessages.render({ 'success':response.success, 'notice': 'Question added to the quiz.' });
  }  

